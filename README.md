# TPC-H benchmark tools

This repository facilitates the use of the [TPC-H benchmark](http://www.tpc.org/tpch/) (or, more precisely, the TPC-H benchmark data and individual queries) for DBMS-related work in and around the [MonetDB](http://www.monetdb.org/) in-memory DBMS

Specifically, the repository comprises:

* A script for automating the tasks of downloading the zipped tabular data (available through [here](http://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236&DB_Short_Name=On-Time)), mildly cleaning it, and loading it into a database with a (mostly) proper schema.
* A set of queries are used as the benchmark, to be executed on all data for years 2000-2008, with correct query result files included as well, as reference.
* Miscellaneous additional potentially useful scripts and SQL queries\.
* A copy of `dbgen`, the TPC's data generation utility for TPC-H. It is included in this repository as allowed for in clause 9 of its [End-User License Agreement (EULA)](http://www.tpc.org/tpc_documents_current_versions/source/tpc_eula.txt). It also available without charge from the TPC, [here](http://www.tpc.org/TPC_Documents_Current_Versions/download_programs/tools-download-request.asp?bm_type=TPC-H&bm_vers=2.17.1&mode=CURRENT-ONLY).

The repository does _not_ contain:

* The specifications of the TPC-H benchmark. The specs are available [here](http://www.tpc.org/tpc_documents_current_versions/current_specifications.asp), or you can directly downloaded the [PDF](http://www.tpc.org/TPC_Documents_Current_Versions/pdf/TPC-H_v2.17.1.pdf).
* Source code or compiled binary for performing the proper TPC-H benchmark, i.e. randomly sending variants of the 22 queries to a server (I would like to have something like that which is FOSS).

Currently, only [MonetDB](https://www.monetdb.org/) is supported as the DBMS into which data is to be loaded - but in the future this may expand.

### Requirements

* The Bourne Again Shell - bash
* various typical Unix-ish command-line tools: unzip, sed, echo and so on.
* MonetDB installed and running
* Enough disk space for the data you want (for SF 1 you're likely to need ~ 2 GB - for the generated pre-loading data and the loaded data together; but this will drop after you delete the pre-loading data down to ~ 1 GB)

### Getting started

1. Set up a MonetDB 'Database Farm'
2. Start the DB farm server (monetdbd) 
3. Invoke `./scripts/setup-db` to generate data for some scale factor; it has the following command-line options:
   ```
Options:
  -r, --recreate              If the TPC-H database exists, recreate it, dropping
                              all existing data. (If this option is unset, the 
                              database must not already exist)
  -s, --scale-factor FACTOR   The amount of test data to generate, in GB
  -G, --use-generated         Use previously-generated table load files (in the
        echo  data generation directory instead of re-generating
                              them using the dbgen utility.
  -g, --dbgen-dir             Look for the TPC-H data generation utility in the
                              specified directory.
  -l, --log-file FILENAME     Name of the file to log output into
  -d, --db-name NAME          Name of the database holding TPC-H test data
                              within the DB farm
  -f, --db-farm PATH          Filesystem path for the root directory of the DB farm
                              with the generated DB
  -p, --port NUMBER           Network port on the local host, which the server
                              will related to the DB farm
  -D, --data-gen-dir PATH     directory in which to generate the TPC-H table data
  -k, --keep-raw-tables       Keep the raw data generated by the tool outside of
                              the DBMS
   ```
4. Execute `scripts/run_benchmark_queries.sh -v` as a sanity check, to make sure you get results that look like the expected answer (you can also diff-compare the results you get with  `scripts/run_benchmark_queries.sh -w` to the reference results in `expected_results/`).

### Questions? Requests? Feedback? Bugs?

Feel free to [open an issue](https://github.com/eyalroz/tpch-tools/issues) or [write me](mailto:E.Rozenberg@cwi.nl).
